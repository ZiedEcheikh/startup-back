<div class="p-grid ui-fluid">
  <div class="p-col-12 p-lg-12">
    <div class="p-grid">
      <div class="p-col-12">
        <div class="card card-w-title">
          <h1 class="titel-steps">Nouvelle vente privée</h1>
          <div class="p-grid ui-fluid">
            <div class="p-col-2"></div>
            <div class="p-col-8">
              <p-steps [model]="itemsStepsMenu" [activeIndex]="2"></p-steps>
            </div>
            <div class="p-col-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="p-grid ui-fluid">
  <div class="p-col-12 p-lg-12">
    <div class="p-grid">
      <div class="p-col-12">
        <div class="card card-w-title">
          <h1 *ngIf="fetchIsSale">Vente {{ currentSale?.label }}</h1>
          <h1 *ngIf="!fetchIsSale">Groupe {{ currentSaleDetails?.label }}</h1>
          <div class="p-grid form-group block-marge">
            <div class="p-col-3 p-md-3"></div>

            <div class="p-col-6 p-md-6">
              <p-table
                #dt
                [columns]="colsGroupsDetails"
                styleClass="ui-table-cars"
                [value]="currentGroupsDetails"
                [paginator]="true"
                [rows]="5"
                dataKey="label"
                selectionMode="single"
                [(selection)]="selectedSaleDetail"
              >
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th
                      *ngFor="let col of columns"
                      [pSortableColumn]="col.field"
                      [ngSwitch]="col.field"
                    >
                      {{ col.header }}
                      <p-sortIcon [field]="col.field"></p-sortIcon>
                    </th>
                    <th style="width: 8em; text-align: center;">
                      <button
                        pButton
                        type="button"
                        (click)="addGroupDetails()"
                        icon="pi pi-plus"
                      ></button>
                    </th>
                  </tr>

                  <tr>
                    <th
                      *ngFor="let col of columns"
                      [ngSwitch]="col.field"
                      style="padding: 0.5em;"
                    >
                      <input
                        *ngSwitchCase="'label'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                      <input
                        *ngSwitchCase="'description'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                    </th>
                    <th style="width: 8em;"></th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-columns="columns">
                  <tr [pSelectableRow]="rowData" [pEditableRow]="rowData">
                    <td *ngIf="!rowData.editable">
                      {{ rowData.label }}
                    </td>
                    <td *ngIf="rowData.editable">
                      <textarea
                        [rows]="3"
                        [cols]="30"
                        pInputTextarea
                        autoResize="autoResize"
                        [(ngModel)]="rowData.label"
                        name="label"
                        required
                        #labelCtrl="ngModel"
                      ></textarea>
                      <p-message
                        *ngIf="!labelCtrl.valid && labelCtrl.touched"
                        severity="error"
                        text="Libellé obligatoire"
                      >
                      </p-message>
                    </td>
                    <td *ngIf="!rowData.editable">{{ rowData.description }}</td>
                    <td *ngIf="rowData.editable">
                      <textarea
                        [rows]="3"
                        [cols]="30"
                        pInputTextarea
                        autoResize="autoResize"
                        [(ngModel)]="rowData.description"
                        name="description"
                        #descriptionCtrl="ngModel"
                      ></textarea>
                    </td>
                    <td>
                      <button
                        *ngIf="!rowData.actionEdit && !rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-warning"
                        (click)="enableEditModeSaleDetails(rowData)"
                        icon="pi pi-pencil"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="!rowData.actionEdit && !rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="confirmDeleteGroupDetails(rowData)"
                        icon="pi pi-trash"
                      ></button>

                      <button
                        *ngIf="rowData.actionEdit"
                        [disabled]="rowData.label.length == 0"
                        pButton
                        type="button"
                        class="ui-button-success"
                        (click)="confirmUpdateSaleDetails(rowData)"
                        icon="pi pi-refresh"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="rowData.actionEdit"
                        [disabled]="rowData.label.length == 0"
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="disabelEditModeSaleDetails(rowData)"
                        icon="pi pi-times"
                      ></button>

                      <button
                        *ngIf="rowData.actionStore"
                        [disabled]="rowData.label.length == 0"
                        pButton
                        type="button"
                        class="ui-button-success"
                        (click)="confirmStoreGroupDetails(rowData)"
                        icon="pi pi-save"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="ignoreStoreGroupDetails(rowData)"
                        icon="pi pi-times"
                      ></button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>

            <div class="p-col-3 p-md-3"></div>
          </div>

          <div class="p-grid form-group block-marge">
            <div class="p-col-3 p-md-3"></div>

            <div class="p-col-6 p-md-6">
              <button
                type="button"
                (click)="goSaleDetails()"
                label="Valider"
                pButton
              ></button>
            </div>

            <div class="p-col-3 p-md-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  header="Confirmation"
  [(visible)]="display"
  modal="true"
  showEffect="fade"
  [style]="{ width: '400px' }"
>
  <p style="margin-top: 1em; margin-bottom: 1em;">
    Voulez-vous supprimer le group ?
  </p>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      (click)="onDeleteGroupDetails()"
      label="Oui"
    ></button>
    <button
      type="button"
      pButton
      icon="pi pi-times"
      (click)="display = false"
      label="Non"
      class="ui-button-secondary"
    ></button>
  </p-footer>
</p-dialog>

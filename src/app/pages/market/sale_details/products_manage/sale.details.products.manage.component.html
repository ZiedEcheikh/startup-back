<div class="p-grid ui-fluid">
  <div class="p-col-12 p-lg-12">
    <div class="p-grid">
      <div class="p-col-12">
        <div class="card card-w-title">
          <h1 class="titel-steps">Nouvelle vente privée</h1>
          <div class="p-grid ui-fluid">
            <div class="p-col-2"></div>
            <div class="p-col-8">
              <p-steps [model]="itemsStepsMenu" [activeIndex]="2"></p-steps>
            </div>
            <div class="p-col-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="p-grid ui-fluid">
  <div class="p-col-12 p-lg-12">
    <div class="p-grid">
      <div class="p-col-12">
        <div class="card card-w-title">
          <h1> Vente {{currentSale?.label}} 
            <span *ngIf='currentGroupDetails != null'> - {{currentGroupDetails.label}}</span></h1>
          <div class="p-grid form-group block-marge">
            <div class="p-col-1 p-md-1"></div>

            <div class="p-col-10 p-md-10">
              <p-table
                #dt
                [columns]="colsOfProductsTable"
                styleClass="ui-table-cars"
                [value]="currentProducts"
                [paginator]="true"
                [rows]="5"
                dataKey="label"
                selectionMode="single"
                [(selection)]="selectedProduct"
                [contextMenu]="cm"
                contextMenuSelectionMode="joint"
              >
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th
                      *ngFor="let col of columns"
                      [pSortableColumn]="col.field"
                      [ngSwitch]="col.field"
                    >
                      {{ col.header }}
                      <p-sortIcon [field]="col.field"></p-sortIcon>
                    </th>
                    <th style="width: 8em; text-align: center;">
                      <button
                        pButton
                        type="button"
                        (click)="addProduct()"
                        icon="pi pi-plus"
                      ></button>
                    </th>
                  </tr>

                  <tr>
                    <th
                      *ngFor="let col of columns"
                      [ngSwitch]="col.field"
                      style="padding: 0.5em;"
                    >
                      <input
                        *ngSwitchCase="'label'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                      <input
                        *ngSwitchCase="'description'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                      <input
                        *ngSwitchCase="'price'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                      <input
                        *ngSwitchCase="'percentage'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                      <input
                        *ngSwitchCase="'stock'"
                        pInputText
                        type="text"
                        placeholder="Commence par"
                        class="ui-column-filter"
                        style="width: 100%; margin-top: 0;"
                        (input)="
                          dt.filter(
                            $event.target.value,
                            col.field,
                            'startsWith'
                          )
                        "
                      />
                    </th>
                    <th style="width: 8em;"></th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-columns="columns">
                  <tr [pSelectableRow]="rowData" [pContextMenuRow]="rowData">
                    <td
                      *ngIf="!rowData.editable"
                      (click)="showPicturesOfProduct($event, op3)"
                    >
                      {{ rowData.label }}
                    </td>
                    <td *ngIf="rowData.editable">
                      <textarea
                        [rows]="3"
                        [cols]="30"
                        pInputTextarea
                        autoResize="autoResize"
                        [(ngModel)]="rowData.label"
                        name="label"
                        required
                        #labelCtrl="ngModel"
                      ></textarea>
                      <p-message
                        *ngIf="!labelCtrl.valid && labelCtrl.touched"
                        severity="error"
                        text="Libellé obligatoire"
                      >
                      </p-message>
                    </td>
                    <td *ngIf="!rowData.editable">{{ rowData.description }}</td>
                    <td *ngIf="rowData.editable">
                      <textarea
                        [rows]="3"
                        [cols]="30"
                        pInputTextarea
                        autoResize="autoResize"
                        [(ngModel)]="rowData.description"
                        name="description"
                        #descriptionCtrl="ngModel"
                      ></textarea>
                    </td>
                    <td *ngIf="!rowData.editable">{{ rowData.price }}</td>
                    <td *ngIf="rowData.editable">
                      <input
                        type="text"
                        pInputText
                        pKeyFilter="money"
                        [(ngModel)]="rowData.price"
                        name="price"
                        required
                        #prixCtrl="ngModel"
                      />
                      <p-message
                        *ngIf="!prixCtrl.valid && prixCtrl.touched"
                        severity="error"
                        text="Prix obligatoire"
                      >
                      </p-message>
                    </td>
                    <td *ngIf="!rowData.editable">{{ rowData.percentage }}%</td>
                    <td *ngIf="rowData.editable">
                      <input
                        type="text"
                        pInputText
                        pKeyFilter="num"
                        [(ngModel)]="rowData.percentage"
                        name="percentage"
                        #percentageCtrl="ngModel"
                      />
                    </td>
                    <td *ngIf="!rowData.editable">{{ rowData.stock }}</td>
                    <td *ngIf="rowData.editable">
                      <input
                        type="text"
                        pInputText
                        pKeyFilter="num"
                        [(ngModel)]="rowData.stock"
                        name="stock"
                        #stockCtrl="ngModel"
                      />
                    </td>

                    <td>
                      <button
                        *ngIf="!rowData.actionEdit && !rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-warning"
                        (click)="enableEditModeProduct(rowData)"
                        icon="pi pi-pencil"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="!rowData.actionEdit && !rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="confirmDeleteProduct(rowData)"
                        icon="pi pi-trash"
                      ></button>

                      <button
                        *ngIf="rowData.actionEdit"
                        [disabled]="
                          rowData.label.length == 0 || rowData.price.length == 0
                        "
                        pButton
                        type="button"
                        class="ui-button-success"
                        (click)="confirmUpdateProduct(rowData)"
                        icon="pi pi-refresh"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="rowData.actionEdit"
                        [disabled]="
                          rowData.label.length == 0 || rowData.price.length == 0
                        "
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="disabelEditModeProduct(rowData)"
                        icon="pi pi-times"
                      ></button>

                      <button
                        *ngIf="rowData.actionStore"
                        [disabled]="
                          rowData.label.length == 0 || rowData.price.length == 0
                        "
                        pButton
                        type="button"
                        class="ui-button-success"
                        (click)="confirmStoreProduct(rowData)"
                        icon="pi pi-save"
                        style="margin-right: 0.5em;"
                      ></button>
                      <button
                        *ngIf="rowData.actionStore"
                        pButton
                        type="button"
                        class="ui-button-danger"
                        (click)="ignoreStoreProduct(rowData)"
                        icon="pi pi-times"
                      ></button>
                      <p-overlayPanel
                        [baseZIndex]="9999999"
                        appendTo="body"
                        #op3
                      >
                        <p-lightbox
                          [images]="rowData.productPictures"
                        ></p-lightbox>
                      </p-overlayPanel>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
              <p-contextMenu #cm [model]="navigationMenu"></p-contextMenu>
            </div>

            <div class="p-col-1 p-md-1"></div>
          </div>

          <div class="p-grid form-group block-marge">
            <div class="p-col-3 p-md-3"></div>

            <div class="p-col-6 p-md-6">
              <button
                type="button"
                (click)="goSaleDetails()"
                label="Valider"
                pButton
              ></button>
            </div>

            <div class="p-col-3 p-md-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  header="Confirmation"
  [(visible)]="display"
  modal="true"
  showEffect="fade"
  [style]="{ width: '400px' }"
>
  <p style="margin-top: 1em; margin-bottom: 1em;">
    Voulez-vous supprimer le produit ?
  </p>
  <p-footer>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      (click)="onDeleteProduct()"
      label="Oui"
    ></button>
    <button
      type="button"
      pButton
      icon="pi pi-times"
      (click)="display = false"
      label="Non"
      class="ui-button-secondary"
    ></button>
  </p-footer>
</p-dialog>
